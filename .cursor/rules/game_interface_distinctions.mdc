---
description: 需要判断mod功能与原版游戏有何不同时，属于quickcast mod专用规则
globs: 
alwaysApply: false
---
# 游戏界面区分与 Mod 交互

此规则旨在明确《开拓者：正义之怒》中与 Mod 功能相关的几个关键游戏界面的区别，以及 Mod 如何与它们交互。理解这些区别对于正确实现 Mod 功能至关重要。主要参考 `[注意事项.md](mdc:注意事项.md)`。

## 1. 核心界面定义与区分

参考 `[注意事项.md](mdc:注意事项.md)` 第 1 点。

*   **行动栏法术书界面 (Action Bar Spellbook UI)**
    *   **特征**: 游戏源码中可能包含 `ActionBar` 相关字眼。
    *   **位置**: 通常是主行动栏上的一个可交互元素，在 `[注意事项.md](mdc:注意事项.md)` 中用"**S**"图标（代表 Spellbook）指代。
    *   **功能**: 显示角色当前环阶可用的法术（已准备、已知等），用于快速选择或拖拽法术到行动栏。
    *   **Mod交互**: **这是 Mod 进行法术绑定的主要场所**。当玩家按下"页面激活键"以进入某个环阶的快捷施法页进行法术绑定设置时，Mod 需要确保此界面打开并显示对应环阶的法术。
    *   **展开/折叠**: 此界面以及类似的"A"(Ability) 和"B"(Backpack) 界面可以通过鼠标点击展开或折叠 (`[注意事项.md](mdc:注意事项.md)` 第 2 点)。

*   **主法术书界面 (Main Spellbook UI / Service Window)**
    *   **特征**: 游戏源码中可能包含 `ServiceWindow` 相关字眼。
    *   **功能**: 游戏中更全面的法术管理界面，用于查看法术详情、学习法术、抄录卷轴、准备每日法术等。
    *   **Mod交互**: Mod **不直接**在此界面进行法术绑定操作。但此界面的状态（如哪些法术被准备了）会影响到"行动栏法术书界面"显示的内容，并间接影响 Mod 的法术绑定。

**重要提示**: 开发者必须清楚地区分这两个界面，避免混淆导致 Mod 逻辑错误。

## 2. 行动栏法术书的打开与环位选择

参考 `[注意事项.md](mdc:注意事项.md)` 第 3 点。

*   **拥有法术书**: 角色必须拥有法术书，其行动栏才会有"**S**"图标，才能打开行动栏法术书界面。若无，"S"图标隐藏。
*   **游戏原有逻辑**: 
    *   玩家点击法术书按钮或按快捷键 -> UI 显示法术书面板。
    *   默认显示0环或上次打开的环位 (X环)。
    *   玩家点击环位数字 -> UI 请求并显示该角色对应环位的法术列表。
*   **Mod 实现**: 当 Mod 的"页面激活键"被按下以进行**法术绑定**时（例如 Ctrl+1 对应1环），Mod 需要：
    1.  模拟打开/确保"行动栏法术书界面"是打开的。
    2.  确保此界面显示的是对应"页面激活键"所代表的法术环阶的法术列表。

## 3. Mod 与行动栏页面切换的关联

参考 `[注意事项.md](mdc:注意事项.md)` 第 5 点。

*   **游戏原有切换行动栏页面**: 
    *   玩家通过点击行动栏翻页箭头或在特定区域滚动鼠标滚轮来切换不同的行动栏页面（Tab）。
    *   系统切换到读取新 Tab/页面的配置数据，UI 根据新配置刷新行动栏上所有格子的显示。
*   **Mod 的"动态主快捷栏"机制**: 
    *   Mod 的"快捷施法页"概念在实现上可以利用游戏固有的行动栏页面系统。
    *   当 Mod 激活一个"快捷施法页"（例如，通过 `Ctrl+3` 激活3环快捷页）时，Mod 实际上是将游戏内部的一个（可能隐藏或专用的）行动栏页面临时调出并显示在主行动栏上。
    *   这个被调出的行动栏页面上预先通过 Mod 的绑定机制"放置"了对应环阶的法术。
    *   **Mod 并非创建全新的主行动栏**，而是利用并管理游戏原有的行动栏切换和数据显示逻辑。
    *   当按下"返回键"时，Mod 将主行动栏恢复到玩家之前正常使用的行动栏页面。

## 4. Mod 的法术绑定与游戏拖拽绑定的对比

参考 `[注意事项.md](mdc:注意事项.md)` 第 4 点。

*   **游戏原有绑定**: 鼠标长按拖拽"行动栏法术书界面"上的法术图标，到主行动栏的格子上，松开后完成绑定。数据上是将法术引用（ID，角色ID）存储到行动栏 Tab 和格子的配置中。
*   **Mod 模拟绑定**: Mod 的键盘绑定功能（在行动栏法术书界面悬停法术按施法键）是对上述拖拽绑定行为的**模拟**。
    *   Mod 需在数据层面实现类似的效果：当通过键盘绑定时，记录法术引用，并将其与 Mod 管理的"快捷施法页"（对应特定环阶）和"施法键"关联起来。
    *   当该"快捷施法页"被激活时，这些已绑定的法术信息需要被用来更新"动态主快捷栏"的显示。

理解这些交互机制，特别是 Mod 如何"接管"或"模拟"游戏原有行为，对于开发稳定且符合玩家直觉的 Mod至关重要。

