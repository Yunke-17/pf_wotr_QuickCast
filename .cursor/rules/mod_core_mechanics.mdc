---
description: 
globs: *.md,*.cs
alwaysApply: false
---
# Mod 核心机制概述

该规则概述了"法术快速施法系统"Mod 的核心机制，旨在提升施法者职业在《开拓者：正义之怒》中的操作效率和流畅度。详细信息请参考 [quickcast.md](mdc:quickcast.md) 和 [注意事项.md](mdc:注意事项.md)。

## 1. 核心概念

参考 `[quickcast.md](mdc:quickcast.md)` 第 3.1 节 和 `[注意事项.md](mdc:注意事项.md)` 第 4 点。

*   **快捷施法页 (Quick Cast Pages)**: 为每个法术环阶（0-9环，及可能的10环神话法术）创建独立的虚拟快捷键映射层，其内容会临时显示在游戏的主行动栏上。
*   **页面激活键 (Page Activation Keys)**: 用于切换到特定环阶快捷施法页的组合键（修饰键 Ctrl + 页面键，例如 `Ctrl + 1` 激活1环页）。
*   **施法键 (Cast Key)**: **指玩家在游戏自带的"按键设置"中为各个主行动栏格子（如"行动栏1"、"行动栏2"）配置的快捷键。** 当Mod的快捷施法页激活并显示在主行动栏时，按下这些游戏原生的行动栏快捷键，即可施放QuickCast在该逻辑槽位上绑定的法术。Mod直接使用这些游戏内配置，不在Mod设置中重新定义。
*   **绑定键 (Bind Key)**: **指由Mod提供的一套独立的、用户可在Mod设置中自定义的单个键盘按键** (例如，键盘按键"1"设置为"绑定到逻辑槽位1"的绑定键)。这些按键**仅在行动栏法术书界面中，当鼠标悬停在一个法术图标上时使用**，用于将该法术指定并绑定到当前QuickCast环阶页的特定逻辑施法槽位上。
*   **逻辑施法槽位 (Logical Cast Slot)**: QuickCast快捷施法页内部的抽象位置（例如"逻辑槽位1"、"逻辑槽位2"等），代表了主行动栏从左到右的格子顺序。每个逻辑槽位通过"绑定键"与一个法术关联，并通过其对应的原生"施法键"触发施法。
*   **返回键 (Return Key)**: 用于退出当前快捷施法页模式，恢复到游戏默认主快捷栏状态的按键 (默认为 `X` 键)。

## 2. 主要机制详解

参考 `[quickcast.md](mdc:quickcast.md)` 第 3.2 节。

### 2.1. 快捷施法页激活 (Activation)

*   **触发**: 按下预设的"页面激活键"组合 (Ctrl + 对应按键)。
    *   默认映射示例: `Ctrl + 1` (1环), `Ctrl + Q` (7环), `Ctrl + ~` (0环)。
*   **效果**: 系统进入对应环阶的快捷施法模式。主行动栏会动态更新以显示当前激活页面的法术绑定。Mod会尝试打开行动栏法术书界面并切换到对应环阶。
*   **前提**: 角色需拥有对应环阶的法术或法术书能力。若无，则会提示。

### 2.2. 法术绑定 (Binding)

参考 `[quickcast.md](mdc:quickcast.md)` 第 3.2.2 节 和 `[注意事项.md](mdc:注意事项.md)` 第 4 点。

*   **操作环境**: 游戏内玩家行动栏法术书界面 (由页面激活键触发打开并定位到对应环阶)。
*   **流程**:
    1.  按下目标环阶的"页面激活键" (例如 `Ctrl + 3`)。
    2.  鼠标悬停在行动栏法术书界面内目标法术的图标上。
    3.  按下为目标"逻辑施法槽位"配置的**单个"绑定键"** (例如，Mod设置中定义的"绑定到逻辑槽位1"的按键)。
*   **效果**: 悬停的法术被绑定到指定环阶快捷施法页的指定逻辑施法槽位。

### 2.3. 快速施法 (Casting)

参考 `[quickcast.md](mdc:quickcast.md)` 第 3.2.3 节 和 `[注意事项.md](mdc:注意事项.md)` 第 4 点的"行动栏格子触发施法的游戏原生逻辑简述"。

*   **操作环境**: 战斗中或任何允许施法的非UI界面状态 (此时行动栏法术书界面通常关闭)。
*   **流程**:
    1.  按下目标环阶的"页面激活键" (例如 `Ctrl + 3`)，激活对应快捷施法页，其内容动态显示在主行动栏。
    2.  按下目标法术所在"逻辑施法槽位"对应的**原生"施法键"** (即游戏为该行动栏格子位置配置的快捷键)。
*   **效果**: Mod确保正确的法术内容 (`QuickCastMechanicActionBarSlotSpell` 实例) 已被放置在主行动栏的对应格子上。游戏原生系统根据该格子的内容处理施法（包括目标选择）。

### 2.4. 返回主快捷栏 (Return to Main Hotbar)

参考 `[quickcast.md](mdc:quickcast.md)` 第 3.2.4 节。

*   **触发**:
    *   按下设定的"返回键" (默认为 `X` 键)。
    *   可选 (可配置): 再次按下当前激活的"页面激活键"。
*   **效果**: 系统退出快捷施法页模式，主快捷栏恢复原状，键盘输入恢复正常。行动栏法术书界面 (若由Mod打开) 关闭。

## 3. 施法后状态管理

参考 `[quickcast.md](mdc:quickcast.md)` 第 3.3 节。

*   **默认行为**: 成功施法后，系统**保持**在当前的快捷施法页。
*   **可选行为 (配置项)**: 允许配置施法成功后**自动返回**主快捷栏模式。

## 4. 设计目标

参考 `[quickcast.md](mdc:quickcast.md)` 第 2 节。

*   **效率提升**: 大幅缩短定位并施放法术的时间和操作。
*   **流畅性增强**: 减少操作中断，保持战斗节奏。
*   **直观性**: 利用法术环阶认知，提供易学的快捷键结构和动态主快捷栏反馈。
*   **高度可定制**: 允许玩家配置核心按键 (页面激活键、绑定键、返回键)。

此 Mod 的目标是通过引入一个虚拟的、按法术环阶组织的"快捷施法页"系统，结合动态主快捷栏显示和键盘绑定，解决游戏原生快捷栏容量有限和操作繁琐的问题。

