---
description: mod核心！任何涉及到mod内容中快捷键以及绑定操作都该注意，属于quickcast mod专用规则
globs: 
alwaysApply: false
---
# Mod 法术绑定流程与按键区分

该规则详细描述了"法术快速施法系统"Mod中，如何将法术精确绑定到快捷施法页的特定逻辑施法槽位，并强调了"绑定键"与"施法键"在不同操作上下文中的关键区别。此过程在游戏内的"行动栏法术书界面"进行。参考 `[quickcast.md](mdc:quickcast.md)` 第 3.1, 3.2.2, 5节 和 `[注意事项.md](mdc:注意事项.md)` 第 1, 4 点。

## 1. 核心按键定义回顾

*   **施法键 (Cast Key)**: 指玩家在游戏自带的"按键设置"中为各个主行动栏格子配置的快捷键 (例如，游戏默认的键盘"1"对应行动栏格子1)。Mod 使用这些原生设置来触发已绑定法术的施放。**不由Mod重新定义。**
*   **绑定键 (Bind Key)**: 指由Mod提供的一套独立的、用户可在Mod设置中为**每个逻辑施法槽位**自定义的**单个键盘按键** (例如，用户可能将键盘按键 "F1" 设置为 "绑定到逻辑槽位1的绑定键")。**仅在行动栏法术书界面悬停法术时用于绑定操作。**

## 2. 关键界面区分

参考 `[注意事项.md](mdc:注意事项.md)` 第 1 点。

*   **行动栏法术书界面 (Action Bar Spellbook UI)**: Mod 进行法术绑定的主要场所。通过主行动栏上的"**S**"图标展开。**当Mod的快捷施法页激活时，此界面应自动打开并显示对应环阶。**
*   **主法术书界面 (Main Spellbook UI / ServiceWindow)**: 查看详细法术信息、抄录法术等。Mod不直接在此界面操作绑定。

## 3. 法术绑定操作流程

参考 `[quickcast.md](mdc:quickcast.md)` 第 3.2.2 节。

1.  **激活目标环阶页面**: 按下目标环阶的"页面激活键" (例如 `Ctrl + 3` for 3环)。
    *   系统响应: Mod 确保"行动栏法术书界面"打开并显示对应环阶（3环）的法术。
2.  **鼠标悬停**: 在已打开的"行动栏法术书界面"中，将鼠标悬停在要绑定的法术图标上。
3.  **按下"绑定键"**: 按下**为目标"逻辑施法槽位"在Mod设置中配置的特定"绑定键"**。
    *   例如：如果玩家在Mod设置中，将键盘按键 "F1" 定义为 "绑定到逻辑施法槽位1的绑定键"，并且想将当前悬停的法术绑定到当前快捷施法页 (3环) 的第1个逻辑槽位，则此时应按下 "F1"。
    *   如果想绑定到第2个逻辑槽位，则应按下为"逻辑槽位2"配置的"绑定键"。

## 4. 绑定效果

参考 `[quickcast.md](mdc:quickcast.md)` 第 3.2.2 节。

*   **数据层面**: 悬停的法术被成功绑定到"3环快捷施法页"的"逻辑施法槽位1"上（以上述例子）。Mod 内部将此法术的引用与快捷施法页（环阶）和逻辑施法槽位（及其关联的绑定键和原生施法键）关联起来。
*   **UI层面**: 应有明确的绑定反馈（如法术图标短暂高亮，或 `quickcast.md` 4.3 中描述的其他反馈）。
*   **独立性**: 每个环阶页面的逻辑施法槽位绑定是相互独立的。

## 5. "绑定键"逻辑与游戏原生快捷键（"施法键"）的严格区分

参考 `[注意事项.md](mdc:注意事项.md)` 第 4 点的"Mod的'绑定键'逻辑与游戏原生行动栏快捷键（'施法键'）的区分"部分。

*   **Mod的"绑定键" (例如，Mod设置的 F1)**:
    *   **作用时机**: 仅在行动栏法术书界面打开，且鼠标悬停在某个法术图标上时生效。
    *   **作用**: 将悬停的法术绑定到QuickCast当前环阶页的、与该"绑定键"对应的"逻辑施法槽位"。
*   **游戏的"施法键"/行动栏快捷键 (例如，游戏设置的键盘 1)**:
    *   **作用时机**: 在快捷施法页激活并显示在主行动栏时（通常此时行动栏法术书界面关闭，或不是绑定操作的焦点）。
    *   **作用**: 施放已绑定在QuickCast某"逻辑施法槽位"（该槽位恰好对应游戏行动栏快捷键"键盘1"的那个格子）上的法术。
*   **关键**: Mod代码需要准确判断当前游戏状态（是否在法术书界面、是否有法术悬停、是快捷施法模式还是绑定预备模式）来区分这两种对物理按键（如果玩家恰好将某个物理按键同时配置为绑定键和施法键，尽管不推荐）的不同意图的响应。

## 6. 模拟拖拽绑定实质

参考 `[注意事项.md](mdc:注意事项.md)` 第 4 点。

*   Mod 的键盘绑定功能，在数据层面，是模拟游戏原有的"鼠标长按拖拽法术图标到行动栏格子"后，将法术引用存储到行动栏配置中的行为。Mod 将此信息存储在自己的数据结构 (`QuickCastBindings`) 中，并在激活快捷施法页时，动态地让主行动栏反映这些绑定，使得后续按下原生"施法键"能触发正确的法术。

