---
description: mod核心！任何涉及到mod内容中快捷键绑定操作都该注意，属于quickcast mod专用规则
globs: 
alwaysApply: false
---
# Mod 法术绑定流程

该规则描述了如何在"法术快速施法系统"Mod 中将法术绑定到特定的施法键。此过程在游戏内的"行动栏法术书界面"进行。参考 `[quickcast.md](mdc:quickcast.md)` 第 3.2.2 节和 `[注意事项.md](mdc:注意事项.md)` 第 1、4 点。

## 1. 关键界面区分

参考 `[注意事项.md](mdc:注意事项.md)` 第 1 点。

*   **行动栏法术书界面 (Action Bar Spellbook UI)**: 这是 Mod 进行法术绑定的主要界面。在游戏源码中应包含 `ActionBar` 字眼。它通常由主行动栏上的"**S**"图标展开，显示角色当前可用的法术（已准备的、自发施法者已知的等）。**这是 Mod 绑定操作的场所。**
*   **主法术书界面 (Main Spellbook UI / ServiceWindow)**: 这是游戏中查看详细法术信息、抄录法术、选择每日法术等的界面。在游戏源码中应包含 `ServiceWindow` 字眼。**Mod 不直接在此界面进行绑定操作**，但此界面的状态（如已准备的法术）会反映到行动栏法术书界面上。

## 2. 法术绑定操作流程

参考 `[quickcast.md](mdc:quickcast.md)` 第 3.2.2 节。

1.  **激活目标环阶页面并打开对应行动栏法术书**: 按下目标环阶的"页面激活键"（例如 `Ctrl + 3`）。
    *   系统响应：Mod 应该确保游戏内的"行动栏法术书界面"已打开，并显示对应法术环阶的内容。如果角色没有该环阶的法术书（例如，一个战士尝试打开法术书），则"S"图标可能不存在或无效，Mod 需要处理此情况。
    *   根据 `[注意事项.md](mdc:注意事项.md)` 第 3 点，游戏原有逻辑是点击法术书按钮（或快捷键）后，UI 显示法术书面板，默认0环或上次环阶。Mod 需要确保激活页面时，正确请求并显示对应环阶的法术列表于行动栏法术书界面。
2.  **鼠标悬停**: 将鼠标悬停在"行动栏法术书界面"内目标环阶的一个法术图标上。
    *   这包括已准备的法术、自发施法者的已知法术，以及超魔后实际占用该环阶的法术。
3.  **按下施法键**: 按下你希望用于施放该法术的"施法键"（例如键盘上的 `2` 键）。

## 3. 绑定效果

*   **数据层面**: 该法术被成功绑定到"3环快捷施法页"（以上述例子）对应的"2号施法快捷键"上。这意味着 Mod 需要将该法术的引用（包含法术ID和所属角色ID）存储起来，与特定的快捷施法页（环阶）和施法键关联。
    *   `[注意事项.md](mdc:注意事项.md)` 第 4 点指出，游戏原有拖拽绑定是将法术引用存储到当前行动栏Tab和页面的对应格子配置中。Mod 需要**模拟这个过程**，将快捷施法页的逻辑映射到游戏的行动栏页面/格子配置上，或者自行维护一套独立的绑定数据结构并使其在施法时生效。
*   **UI层面**: 应有明确的绑定反馈（如法术图标短暂高亮）。
*   **独立性**: 每个环阶页面的施法键绑定是相互独立的。

## 4. 模拟拖拽绑定

参考 `[注意事项.md](mdc:注意事项.md)` 第 4 点。

*   Mod 的键盘绑定功能实质上是**模拟**游戏原有的"鼠标长按拖拽法术图标到行动栏格子"的绑定功能。
*   **游戏原有拖拽逻辑**: 
    1.  玩家操作："鼠标长按拖拽法术图标"。
        *   UI层面：图标进入"拖拽状态"，副本跟随鼠标。
        *   数据层面：系统记录被拖拽法术的引用。
    2.  玩家操作："拖拽至主行动栏的格子"，松开鼠标。
        *   UI层面：图标"吸附"到格子。
        *   数据层面：法术引用（含法术ID、角色ID）存储到当前行动栏Tab和页面的格子配置中。
        *   UI刷新格子显示。
*   **Mod 实现**: Mod 需要通过代码实现类似的数据存储逻辑，当用户通过键盘快捷键绑定时，将法术信息关联到 Mod 内部管理的快捷施法页和键位上，并在激活快捷施法页时，让主行动栏反映这些绑定。

