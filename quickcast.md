1. 引言与背景
1.1. 项目概述
本文档旨在详细描述一款针对《开拓者：正义之怒》(Pathfinder: Wrath of the Righteous)
设计的 Mod 概念——"法术快速施法系统"。该系统旨在通过引入一套基于键盘、按法术环
阶分层的快捷键机制，显著提升施法者职业在战斗中的操作效率和流畅度。
1.2. 游戏现状与痛点分析
《开拓者：正义之怒》作为一款深度 CRPG，其施法者职业（如法师、术士、牧师、先
知等）拥有极为庞大的法术库。随着游戏进程深入，尤其是在中后期，玩家需要管理的法术
和能力数量激增。
核心痛点：游戏原生的快捷栏容量有限，即使配合折叠栏和法术书界面，在高强度、快
节奏的战斗中进行精确、快速的法术选择与施放，操作依然显得繁琐、缓慢。频繁的鼠标点
击、界面切换（打开操作栏法术书、展开折叠栏）容易打断战斗节奏，降低反应速度，影响
沉浸感。
1.3. 玩家核心诉求
面对上述痛点，玩家群体（尤其是高难度玩家和施法者爱好者）普遍存在以下诉求：
●需要一种更直接、更快速的法术选择与施法方式。
●减少对鼠标的依赖，转向更高效的键盘操作。
●避免或减少因选择法术而暂停游戏或进行多层 UI 跳转。
●希望有一种符合直觉的法术组织方式。
2. 设计目标
本 Mod 的核心设计目标如下：
●效率提升: 大幅缩短在高强度战斗中定位并施放特定法术所需的时间和操作步骤。
●流畅性增强: 减少因法术选择导致的操作中断和游戏暂停，保持战斗节奏。
●直观性: 利用玩家对法术环阶的固有认知，提供逻辑清晰、易于学习和记忆的快捷键
组织结构。
●高度可定制: 允许玩家根据个人习惯和键盘布局自由配置核心按键，并确保与游戏本
体及其他 Mod 的良好兼容性。 3. 核心系统设计：分层快捷施法页
本 Mod 的核心是引入一个虚拟的、按法术环阶组织的"快捷施法页"系统。
3.1. 核心概念定义
●快捷施法页: 为每个法术环阶（0 环至 9 环，以及可能的 10 环神话法术）创建一个独立的虚拟快捷键映射层，其内容会临时显示在游戏的主行动栏上。
●页面激活键: 用于切换到特定环阶快捷施法页的组合键（修饰键 ctrl +页面键）。
●施法键 (Cast Key): **指玩家在游戏自带的"按键设置"中为各个主行动栏格子（如"行动栏1"、"行动栏2"，见图1）配置的快捷键。** 当Mod的快捷施法页激活并显示在主行动栏时，按下这些游戏原生的行动栏快捷键，即可施放QuickCast在该逻辑槽位上绑定的法术。
●绑定键 (Bind Key): **指由Mod提供的一套独立的、用户可在Mod设置中自定义的单个键盘按键**（例如，玩家可以将键盘按键"1"设置为"绑定到逻辑槽位1"的绑定键，键盘按键"2"为"绑定到逻辑槽位2"的绑定键，以此类推）。这些按键**仅在行动栏法术书界面中，当鼠标悬停在一个法术图标上时使用**，用于将该法术指定并绑定到当前QuickCast环阶页的特定逻辑施法槽位上。
●逻辑施法槽位 (Logical Cast Slot): QuickCast快捷施法页内部的抽象位置（例如"逻辑槽位1"、"逻辑槽位2"等），代表了主行动栏从左到右的格子顺序。每个逻辑槽位通过"绑定键"与一个法术关联，并通过其对应的原生"施法键"（即游戏行动栏该位置的快捷键）触发施法。
●返回键: 用于退出当前快捷施法页模式，恢复到游戏默认主快捷栏状态的按键。
3.2. 主要机制详解
3.2.1. 快捷施法页激活
触发方式:
按下预设的"页面激活键"组合。
默认映射 (可自定义):
Ctrl + 1 ~ Ctrl + 6: 激活 1 环 ~ 6 环法术页。
Ctrl + Q, W, E, R: 激活 7 环, 8 环, 9 环, 10 环法术页 (选择邻近左手操作方式易
按的字母键)。
Ctrl + ~ (波浪号/反引号): 激活 0 环法术页。
效果:
系统进入对应环阶的快捷施法模式，主行动栏将动态显示该快捷施法页的内容，后续按下的原生"施法键"将作用于该页面的绑定。
3.2.2. 法术绑定
操作环境:
游戏内玩家操作栏法术书界面（当有QuickCast页面激活键被按下以准备绑定时，Mod应确保此界面打开并显示对应环阶）。
流程:
①.按下目标环阶的"页面激活键"（例如 Ctrl + 3），表明意图为3环快捷施法页进行法术设置。Mod应确保行动栏法术书界面打开并显示对应环阶的法术。
②.将鼠标悬停在行动栏法术书界面内对应环阶的一个法术图标上。
③.按下为目标"逻辑施法槽位"配置的**单个"绑定键"**。例如，如果玩家在Mod设置中将键盘按键"1"配置为"绑定到逻辑施法槽位1"的绑定键，则此时按下键盘"1"。
效果:
该法术被成功绑定到"3环快捷施法页"的"**逻辑施法槽位1**"上。
每个环阶页面的逻辑施法槽位绑定是相互独立的。当该快捷施法页激活时，"逻辑施法槽位1"上的法术将通过游戏为"行动栏1"设置的快捷键（即"施法键"）来施放。
3.2.3. 快速施法
操作环境: 战斗中或任何允许施法的非 UI 界面状态（此时行动栏法术书界面通常是关闭的）。
流程:
①.按下目标环阶的"页面激活键"（例如 Ctrl + 3），激活3环快捷施法页，其内容动态显示在主行动栏。
②.按下目标法术所在"逻辑施法槽位"对应的**原生"施法键"**（即玩家在游戏设置为该行动栏格子设置的快捷键）。例如，如果火球术被绑定到了"逻辑施法槽位1"，而玩家为游戏"行动栏1"设置的快捷键是键盘"1"，则此时按下键盘"1"。
效果:
主行动栏上"逻辑施法槽位1"所对应的原生游戏格子（此时显示着火球术图标）接收到其快捷键（键盘"1"）输入。**游戏系统会像处理任何正常的行动栏快捷键一样，自动根据该格子上承载的法术（即火球术的 `AbilityData`，由Mod的 `QuickCastMechanicActionBarSlotSpell` 提供）的类型来启动施法流程**：
  ● **对于需要选择目标的法术** (例如，火球术): 游戏会自动进入目标选择模式，等待玩家指定目标或区域。
  ● **对于目标是施法者自身的法术**: 游戏会自动对当前选定单位执行施法。
Mod的核心职责是确保正确的法术内容（通过`QuickCastMechanicActionBarSlotSpell`）被放置在主行动栏的正确格子上。实际的施法指令发出、目标选择UI的激活、以及法术效果的执行均由游戏原生系统根据该格子的内容进行处理。
若施法成功，则消耗对应的法术位或每日使用次数，并执行法术效果。
3.2.4. 返回主快捷栏
触发方式 (二选一或可选):
专用返回键: 按下设定的"返回键"。
默认映射 : X 键 (需确保不与常用游戏功能冲突)。
双击激活键 : 再次按下当前激活的"页面激活键"（例如，已激活 Ctrl + 3，则 再 按
一次 Ctrl + 3）。此行为应可在 Mod 设置中启用/禁用。
效果:
系统退出当前的快捷施法页模式，主快捷栏恢复显示其原本配置的内容，键盘输入
恢复正常游戏逻辑。
行动栏法术书界面（如果是由Mod打开的）也应当关闭。
3.3. 施法后状态管理
默认行为:
成功施放一个法术后，系统 保持 在当前的快捷施法页，方便玩家连续施放同一环
阶的其他法术（例如，连续释放多个 2 环法术）。
可选行为 (配置项):
提供一个设置选项，允许玩家选择在每次成功施法后 自动返回 主快捷栏模式。 4. 用户界面 (UI) 与用户体验 (UX) 设计
清晰直观的 UI/UX 是本 Mod 成功的关键。
4.1. 激活状态指示器
必要性:
必须有一个清晰的提示告知玩家当前处于哪个快捷施法页模式。
表现形式:
当快捷施法页被激活或停用时，相关的状态信息（例如："快捷施法: 3环 已激活" 或 "快捷施法: 返回主快捷栏"）将作为一条新的消息被添加到游戏内建的事件日志窗口的"事件"标签页下。
行为: 当快捷施法页相关的状态发生变化时（激活、停用），对应的消息会出现在事件日志中。
4.2. 动态主快捷栏-关键交互
这部分机制源自游戏原有的操作栏只能通过鼠标点击或者鼠标滚轮滑动进行上下切换
的逻辑，mod 本身只是调用该逻辑通过键盘输入的方式进行切换管理。
核心机制:
当一个快捷施法页被激活时，游戏的主快捷栏（游戏画面中底部的那一排，如图2所示） **必须**临时改变其显示内容，以反映当前激活页面的法术绑定情况。此时，主快捷栏上第N个格子显示的图标，其对应的施法操作将由玩家在游戏"按键设置"中为"行动栏N"配置的快捷键（即该逻辑槽位的"施法键"）触发。
具体表现:
例如按下 Ctrl + 3 激活3环快捷施法页：
主快捷栏的第 1 个格子（逻辑施法槽位1）：显示绑定到该槽位的 3 环法术图标，并在图标角落或下方显示按键提示 "**[玩家为"行动栏1"在游戏设置中配置的快捷键]**"。
主快捷栏的第 2 个格子（逻辑施法槽位2）：显示绑定到该槽位的 3 环法术图标，并显示按键提示 "**[玩家为"行动栏2"在游戏设置中配置的快捷键]**"。
以此类推。
对于快捷栏上未绑定法术，表现为没有法术图标在快捷键格子时，使用原版操作栏
对于未拖拽并安放法术/能力/道具的显示逻辑
恢复:
当按下"返回键"(X) 或通过其他方式返回主快捷栏模式时，主快捷栏 立即恢复 显示
其原本由玩家手动放置的技能、物品等内容。
重要性:
这是提供即时视觉反馈、减少记忆负担、让系统直观易用的核心环节。玩家无需记
忆每个环阶每个按键绑的是什么，只需激活页面，看一眼动态变化的快捷栏即可。
4.3. 绑定与施法反馈
●绑定反馈: 在行动栏法术书界面，当鼠标悬停于法术并成功通过"绑定键"将其绑定到快捷施法页的某个逻辑施法槽位时，应有明确反馈：
●视觉: 法术图标短暂高亮、闪烁，或旁边出现一个小小的绑定成功标记。
●听觉 (可选): 播放一个轻微、确认性的音效。
施法反馈:
遵循游戏原有的施法动画、音效、目标效果等。
4.4. 操作误触
为了防止在战斗中施法法术时鼠标悬停在法术上，此时执行快捷键操作不是施法法术，
而是设置法术快捷键，操作栏法术书 UI 必须调整至在战斗中不易触碰的位置（例如左下方
位置）。
5. 自定义与配置选项
为了最大化兼容性和满足玩家个性化需求，Mod 设置界面应提供以下配置选项：
操作按键相关：
●页面激活键映射:
允许用户重新定义所有环阶（0-10）的页面激活组合键。
●施法键: **Mod直接使用游戏"按键设置"中玩家为各行动栏格子（"行动栏1"至"行动栏N"，对应Mod的"逻辑施法槽位1"至"逻辑施法槽位N"）配置的快捷键作为施法键。** 因此，Mod设置中不提供施法键的重新定义，玩家应在游戏本身的按键设置中修改行动栏快捷键。Mod的动态主快捷栏会显示这些游戏内配置的按键作为提示。
●绑定键映射 (Bind Key Mapping):
允许用户在Mod设置中，为将法术绑定到快捷施法页的"逻辑施法槽位1"、"逻辑施法槽位2"... "逻辑施法槽位N"的操作，分别配置**单个键盘按键**作为"**绑定键**"。例如，配置键盘按键"1"为"绑定到逻辑槽位1"的绑定键，键盘按键"2"为"绑定到逻辑施法槽位2"的绑定键等。这些绑定键仅在行动栏法术书界面悬停法术时生效。
●返回键映射:
允许用户自定义"返回主快捷栏"的按键。
以上需要确保按键冲突时应提示"按键已被占用，是否继续修改？"
返回主快捷栏相关：
●双击激活键返回:
提供开关，控制是否允许通过再次按下页面激活键来返回主快捷栏。
●施法后行为:
提供选项，选择施法成功后是"保持在当前页"还是"自动返回主快捷栏"。
UI 显示相关：
●操作栏法术书 UI 大小调整：
提供显示预设的 UI 样式——行 X 列。1＜行≤5，列固定为 5，例如 3 X 5。
防止打开快捷施法页打开操作栏法术书大范围占据游戏画面的情况。
6. 技术实现考量
6.1. 开发平台与框架
使用 Unity Mod Manager 等社区常用框架进行开发，需要 Harmony 库进行游戏代
码注入，并绕过一部分 Private 或 Protected 的类、方法、属性、字段。
需要通过 Dnspy 之类的 C#反编译工具将 Assembly-CSharp.dll 之类的相关程序集进
行反编译，并查询源代码以及接口。
6.2. 其他 Mod 冲突管理
避免与游戏默认按键、其他常用 Mod（如 Bubble Buffs, ToyBox 等）的冲突。
6.3. 数据持久化
法术绑定信息（哪个环阶的哪个施法键绑定了哪个法术）需要被可靠地存储和加载。
存储方案:
与角色数据绑定，存储在游戏存档中或 Mod 自身的配置文件中，确保存档加载、
角色切换时能正确恢复绑定设置。
6.4. 性能优化
Mod 的按键监听、UI 更新（尤其是动态快捷栏）逻辑需要高效实现，避免在战斗中引
入卡顿或性能下降，例如尽量少使用反射来获取接口。
避免在游戏的主循环中进行过于频繁或耗时的检查。 7. 项目范围与未来扩展
7. 核心范围
实现完整的 0 环至 10 环法术的快捷施法页系统。
包含核心机制：页面激活、法术绑定（在操作栏法术书界面内）、快速施法、返回主快
捷栏。
实现关键 UI/UX：激活状态指示器、动态主快捷栏。
提供必要的绑定与施法反馈。
提供核心的自定义选项：按键映射、施法后行为。
确保对准备/自发施法者和超魔法术的基本兼容性。
8. 总结
"分层快捷施法页" Mod 旨在通过一个直观、基于键盘的系统，根本性地解决《开拓者：
正义之怒》中后期施法者操作效率低下的核心痛点。其关键优势在于：
显著提升效率: 大幅减少选择和施放法术的操作时间。
改善战斗流畅度: 减少暂停和鼠标操作，保持战斗节奏。
直观设计: 利用法术环阶的天然分类，结合动态快捷栏反馈，易于上手。
高度定制: 适应不同玩家习惯，降低按键冲突风险。
该 Mod 对于追求高难度挑战、喜爱施法者职业、以及寻求更流畅战斗体验的玩家具有
极高的潜在价值。其成功的关键在于稳定可靠的实现、直观无缝的 UI/UX 设计（尤其是动态
主快捷栏），以及强大的自定义能力。